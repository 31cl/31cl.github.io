<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Editor for AyePages</title>
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .header-field {
            margin-bottom: 10px;
        }
        .embed-toolbox {
            margin-top: 20px;
        }
        .alert {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Markdown Editor for AyePages</h1>
    
    <!-- Header Input Fields -->
    <div class="header-field">
        <label for="post-title">Title:</label>
        <input type="text" id="post-title" placeholder="Post Title">
    </div>
    <div class="header-field">
        <label for="post-date">Date:</label>
        <input type="datetime-local" id="post-date">
    </div>
    <div class="header-field">
        <label for="post-categories">Categories (comma-separated):</label>
        <input type="text" id="post-categories" placeholder="e.g., blog, intro">
    </div>
    <div class="header-field">
        <label for="post-tags">Tags (comma-separated):</label>
        <input type="text" id="post-tags" placeholder="e.g., demo, blog">
    </div>

    <!-- EasyMDE Markdown Editor -->
    <textarea id="my-text-area"></textarea>

    <!-- Checkbox to Show Header -->
    <div>
        <input type="checkbox" id="show-header-checkbox">
        <label for="show-header-checkbox">Show Header</label>
    </div>

    <!-- Header Display Box -->
    <textarea id="header-content" style="display:none;" readonly></textarea>
    
    <!-- Copy Header to Clipboard Button -->
    <button id="copy-header">Copy Header to Clipboard</button>

    <!-- GitHub URL Input -->
    <div class="header-field">
        <label for="github-url">GitHub URL:</label>
        <input type="text" id="github-url" placeholder="GitHub URL (for submitting the post)">
    </div>

    <!-- Load Button -->
    <button id="load-button">Load Markdown File</button>
    
    <!-- Submit Button -->
    <button id="submit-button">Submit to GitHub</button>
    
    <!-- Embedding Toolbox -->
    <div class="embed-toolbox">
        <label>Embedding Toolbox:</label>
        <button onclick="insertEmbed('youtube')">Embed YouTube</button>
        <button onclick="insertEmbed('linkedin')">Embed LinkedIn</button>
        <!-- Add more embedding options as needed -->
    </div>

    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script>
        const easyMDE = new EasyMDE({element: document.getElementById('my-text-area')});

        // Update the Header Content Textarea
        document.getElementById('show-header-checkbox').addEventListener('change', function () {
            const headerContent = generateHeaderContent();
            const headerBox = document.getElementById('header-content');
            if (this.checked) {
                headerBox.style.display = 'block';
                headerBox.value = headerContent;
            } else {
                headerBox.style.display = 'none';
            }
        });

        // Generate the Header Content based on Input Fields
        function generateHeaderContent() {
            const title = document.getElementById('post-title').value;
            const date = document.getElementById('post-date').value || new Date().toISOString();
            const categories = document.getElementById('post-categories').value.split(',').map(cat => cat.trim());
            const tags = document.getElementById('post-tags').value.split(',').map(tag => tag.trim());
            return `---\ntitle: "${title}"\ndate: ${date}\ncategories:\n  - ${categories.join('\n  - ')}\ntags:\n  - ${tags.join('\n  - ')}\n---\n`;
        }

        // Copy Header to Clipboard
        document.getElementById('copy-header').addEventListener('click', function () {
            const headerContent = document.getElementById('header-content').value;
            navigator.clipboard.writeText(headerContent).then(() => {
                alert('Header copied to clipboard. Use Ctrl + A to select all text and Ctrl + V to replace with copied header.');
            });
        });

        // Load Markdown File from GitHub URL
        document.getElementById('load-button').addEventListener('click', function () {
            const githubUrl = document.getElementById('github-url').value;
            const rawUrl = githubUrl.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/');
            fetch(rawUrl)
                .then(response => response.text())
                .then(data => {
                    // Parse date and other details if possible
                    const matches = data.match(/date: (.+)/);
                    const dateValue = matches ? new Date(matches[1]).toISOString().slice(0, 16) : new Date().toISOString().slice(0, 16);
                    document.getElementById('post-date').value = dateValue;

                    // Set EasyMDE value
                    easyMDE.value(data.split('---')[2].trim());
                })
                .catch(() => {
                    alert('Failed to load file. Using current date and time.');
                    document.getElementById('post-date').value = new Date().toISOString().slice(0, 16);
                });
        });

        // Insert Embed Code into EasyMDE
        function insertEmbed(type) {
            let embedCode = '';
            switch (type) {
                case 'youtube':
                    embedCode = '[![YouTube Video](https://img.youtube.com/vi/VIDEO_ID/0.jpg)](https://www.youtube.com/watch?v=VIDEO_ID)';
                    break;
                case 'linkedin':
                    embedCode = '<a href="LINKEDIN_URL">LinkedIn Post</a>';
                    break;
                default:
                    embedCode = '';
            }
            easyMDE.codemirror.replaceSelection(embedCode);
        }

        // Submit to GitHub
        document.getElementById('submit-button').addEventListener('click', function () {
            const githubUrl = document.getElementById('github-url').value;
            const content = encodeURIComponent(generateHeaderContent() + easyMDE.value());
            const commitMessage = encodeURIComponent('Update Post');
            const filePathParts = githubUrl.split('github.com/')[1].split('/');
            const isBlob = githubUrl.includes('/blob/');
            let filePath = filePathParts.slice(1).join('/').replace('/blob/', '/');

            let targetUrl;
            if (isBlob) {
                targetUrl = `https://github.com/${filePath}/edit/master`;
                navigator.clipboard.writeText(generateHeaderContent() + easyMDE.value()).then(() => {
                    alert('Opening the edit page. Use Ctrl + A to select all text and Ctrl + V to replace with copied content.');
                });
            } else {
                const filename = encodeURIComponent(filePathParts.pop());
                filePath = filePathParts.join('/');
                targetUrl = `https://github.com/${filePath}/new/master/${filename}?value=${content}&message=${commitMessage}&filename=${filename}`;
                window.open(targetUrl, '_blank');
            }
        });
    </script>
</body>
</html>
